<div class="default-header">
  <div class="btn1-container">
    <button (click)="goBack()" mat-button>
      <img src="../../assets/icons/back.svg" />
      بازگشت
    </button>
  </div>
</div>

<div class="event-card">
  <div class="images-container">
    <img
      *ngIf="event.imagePath"
      [src]="event.imagePath"
      alt="Event Image"
      class="event-image"
    />
    <img
      *ngIf="!event.imagePath"
      src="assets/icons/group-default-photo.svg"
      alt="Event Image"
      class="event-image-replacement"
    />
  </div>

  <div class="event-info">
    <div class="event-date">{{ persianDate }}</div>

    <h3 class="event-title">{{ event.title }}</h3>

    <div class="event-header becheener">
      <div class="content">
        <img
          *ngIf="event.owner?.image"
          [src]="event.owner?.image"
          alt="owner image"
          class="profile-image"
        />
        <div
          *ngIf="!event.owner?.image"
          alt="owner image"
          class="profile-image-replacement"
        >
        {{event.owner!!.name[0]}}
        </div>
        <div class="becheener-name-container">
          <div class="role">برنامه بچین:</div>
          <div class="becheener-name">{{ event.owner?.name }}</div>
        </div>
      </div>
    </div>

    <div class="event-header" *ngFor="let member of event.members">
      <div class="content">
        <img *ngIf="member.image" [src]="member.image" alt="Profile" class="profile-image" />
        <div class="member-profile-image-replacement" *ngIf="!member.image">
          {{member.name[0]}}
        </div>
        <span class="profile-name">{{ member.name }}</span>
      </div>
    </div>

    <div class="divider"></div>

    <div *ngIf="!isEventPrivate && tags.length > 0" class="tags-container">
      <mat-chip-list aria-label="Event Tags" class="tags-chip-list">
        <mat-chip *ngFor="let tag of tags" class="tags-chip">
          #{{ tag }}
        </mat-chip>
      </mat-chip-list>
    </div>

    <div
      *ngIf="
        isEventPrivate &&
        (tasksAssigned.length > 0 || tasksUnassigned.length > 0)
      "
      class="tasks-container"
    >
      <div *ngIf="tasksAssigned.length > 0" class="assigned-tasks">
        <mat-chip-list aria-label="Assigned Tasks" class="tasks-chip-list">
          <mat-chip
            *ngFor="let task of tasksAssigned"
            class="task-chip"
            [ngClass]="{
              'task-chip--assigned-to-me':
                task.assignedUserId === profile.userId,
              'task-chip--assigned-to-others':
                task.assignedUserId !== profile.userId
            }"
          >
            <div class="task-chip__content">
              <span
                class="task-chip__title"
                [ngClass]="{
                  'task-chip__title--assigned-to-me':
                    task.assignedUserId === profile.userId,
                  'task-chip__title--assigned-to-others':
                    task.assignedUserId !== profile.userId
                }"
              >
                {{ task.title }}
              </span>

              <span
                class="task-chip__assigned-info"
                [ngClass]="{
                  'task-chip__assigned-info--assigned-to-me':
                    task.assignedUserId === profile.userId,
                  'task-chip__assigned-info--assigned-to-others':
                    task.assignedUserId !== profile.userId
                }"
              >
                با
                <span
                  *ngIf="task.assignedUserId === profile.userId; else otherUser"
                  class="task-chip__assigned-me"
                >
                  من
                </span>
                <ng-template #otherUser>{{
                  task.assignedUserName
                }}</ng-template>
              </span>

              <span *ngIf="task.assignedUserId === profile.userId">
                <button
                  mat-icon-button
                  class="task-chip__remove-btn"
                  (click)="removeTaskFromMe(task.id)"
                >
                  <img
                    src="../../assets/icons/close-icon.svg"
                    alt="Remove Task"
                    class="task-chip__remove-icon"
                  />
                </button>
              </span>
            </div>
          </mat-chip>
        </mat-chip-list>
      </div>

      <div *ngIf="tasksUnassigned.length > 0" class="unassigned-tasks">
        <h5 class="unassigned-tasks__title">کارایی که کسی گردن نگرفته:</h5>
        <mat-chip-list aria-label="Unassigned Tasks" class="tasks-chip-list">
          <mat-chip
            *ngFor="let task of tasksUnassigned"
            class="task-chip task-chip--unassigned-task"
            (click)="assignTaskToMe(task.id)"
          >
            <img
              src="../../assets/icons/task-icon.svg"
              alt="Unassigned Task Icon"
              class="task-chip__icon"
            />
            <span class="task-chip__title task-chip__title--unassigned">
              {{ task.title }}
            </span>
          </mat-chip>
        </mat-chip-list>
      </div>
    </div>

    <div class="divider"></div>

    <div class="address-section">
      <div class="title">
        <img src="assets/icons/location.svg" alt="" />
        <span style="margin: 0 0.5rem">{{ event.cityName }}</span>
        <span>{{ event.address }}</span>
      </div>
      <div
        id="map"
        style="height: 12rem; width: 100%; margin-top: 0.5rem; z-index: 1"
      ></div>
    </div>

    <div class="divider"></div>

    <p class="event-description">{{ event.description }}</p>
  </div>
</div>

<div *ngIf="!isPastEvent && isUserInMembers" class="submit-container">
  <span> توهم تو برنامه ای.</span>

  <button mat-stroked-button (click)="LeaveEvent()">خارج شدن از برنامه</button>
</div>

<!-- <div *ngIf="isPastEvent && isUserInMembers" class="submit-container">
  <span> برنامه تموم شد، چطور بود؟</span>

  <button mat-flat-button>نظر دادن</button>
</div> -->

<div *ngIf="!isPastEvent && !isUserInMembers" class="submit-container">
  <span>می خوای تو هم تو این برنامه باشی؟</span>
  <button mat-flat-button (click)="joinEvent()">منم هستم</button>
</div>

<div *ngIf="isPastEvent" class="submit-container">
  <span>دیر رسیدی برنامه تموم شد.</span>
</div>
